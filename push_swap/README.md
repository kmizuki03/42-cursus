# push_swap - スタックソートアルゴリズムの実装

## 1. 目的

本課題では、2つのスタック（stack A、stack B）と限られた操作のみを使用して、整数のシーケンスをソートするアルゴリズムを実装する。効率的なソートアルゴリズムの設計、コスト計算、最適化手法の理解を目的とする。

## 2. 背景

スタックソートは、計算理論において興味深い問題の一つである。本課題では、以下の操作のみを使用してソートを行う必要がある：

- **swap**: スタックの先頭2要素を交換
- **push**: 一方のスタックの先頭要素を他方に移動
- **rotate**: スタック全体を1つ回転（先頭が末尾に）
- **reverse rotate**: スタック全体を逆回転（末尾が先頭に）

これらの制約下で、できるだけ少ない操作回数でソートを実現することが課題である。

## 3. 実装内容

### 3.1 データ構造

リンクリストを使用してスタックを実装した。各ノードは値（`value`）とインデックス（`index`）を持ち、ソート済みの位置を追跡する。

### 3.2 ソート戦略

スタックのサイズに応じて、異なるソートアルゴリズムを選択した：

- **サイズ2**: 単純なswap操作
- **サイズ3**: 3要素の全パターンに対する最適解を実装
- **サイズ4-5**: 小規模用の最適化されたアルゴリズム
- **サイズ6以上**: Türkアルゴリズム（後述）

### 3.3 Türkアルゴリズム

大規模なスタックに対しては、Türkアルゴリズム（または類似の手法）を実装した。このアルゴリズムの基本的な流れは以下の通りである：

1. **インデックス付け**: 各要素に、ソート後の位置を示すインデックスを割り当て
2. **チャンク分割**: スタックを複数のチャンクに分割し、段階的にソート
3. **コスト計算**: 各要素をスタックBに移動する際のコスト（必要な操作数）を計算
4. **最適要素選択**: コストが最小の要素を選択して移動
5. **最適回転**: 両方のスタックを同時に回転できる場合は、`rr`や`rrr`を使用して操作数を削減
6. **最終配置**: スタックBからスタックAに戻す際も、最適な位置を計算

### 3.4 コスト計算

各要素を移動する際のコストを以下のように計算した：

- スタックAでの位置（回転に必要な操作数）
- スタックBでの目標位置（回転に必要な操作数）
- 同時回転可能な場合の削減

このコスト計算により、常に最適な要素を選択して移動することができる。

## 4. 技術的な工夫点

### 4.1 インデックス付け

実際の値の代わりにインデックスを使用することで、負の数や大きな数値にも対応し、比較処理を簡素化した。

### 4.2 コスト最適化

`rr`（両方のスタックを同時に回転）や`rrr`（両方のスタックを同時に逆回転）を使用することで、操作数を大幅に削減した。コスト計算時に、これらの同時操作を考慮した。

### 4.3 エッジケースの処理

以下のエッジケースに対応した：

- 既にソート済みのスタック
- 重複する値の検出
- 無効な入力の検証

### 4.4 メモリ管理

リンクリストの適切な管理と、エラー時のメモリ解放を実装した。

## 5. 使用方法

```bash
# コンパイル
make

# 実行例
./push_swap 4 2 5 1 3

# 操作回数を確認
./push_swap 4 2 5 1 3 | wc -l
```

### 5.1 入力形式

- コマンドライン引数として整数のリストを受け取る
- または、文字列として渡された場合は`ft_split`で分割

## 6. パフォーマンス

実装したアルゴリズムのパフォーマンスは以下の通りである：

- **3要素**: 最大2-3操作
- **5要素**: 最大12操作
- **100要素**: 目標700操作以下（実装によって異なる）
- **500要素**: 目標5500操作以下（実装によって異なる）

## 7. 考察

本課題を通じて、制約下でのアルゴリズム設計と最適化の難しさを実感した。制約下でのアルゴリズム設計の難しさと、コスト計算と最適化の重要性について理解を深めた。また、データ構造（リンクリスト）の実用的な活用と、段階的な問題解決アプローチ（小規模から大規模へ）について実践的な知識を得た。特に、コスト計算と最適要素選択の実装は、理論と実装のギャップを埋める経験となった。スタックソートという一見単純な問題が、実際には非常に深い最適化の余地があることを学んだ。これらの経験は、今後のアルゴリズム設計において有用となるだろう。

